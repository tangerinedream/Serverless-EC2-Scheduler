# This is a Workload Specification file, consumed by the Loader.
# The Loader will use this yaml content to populate (create or update) DynamoDB with the specifications of your Workload.
# The CloudFormation stack CFStackForCodePipeline must have been successfully deployed as a precursor to running the loader,
#   as that creates the DynamoDB Tables into which this content is loaded.

workloads:
  table: WorkloadSpecification
  workload:
    SpecName: SampleWorkload-02
    WorkloadRegion: us-west-2
    SNSTopicName: SchedulerSNSTopic
    # SSMS3BucketName: <insert bucket name if 'Instance Exemption' (AWS SSM) feature desired>
    # SSMS3KeyPrefixName: ssmRemoteCommandResults
    # VPC_ID: vpc-xxxxxxxx
    WorkloadFilterTagName: Environment
    WorkloadFilterTagValue: ENV002
    TierFilterTagName: ApplicationRole
    ScaleInstanceDelay: '5'
 
tiers:
  table: TierSpecification
  tiers:

    - TierTagValue: Role_Web
      SpecName: SampleWorkload-02
      TierStart:
        TierSequence: 2
        TierSynchronization: 'False'
        InterTierOrchestrationDelay: 1
      TierStop:
        TierSequence: 0
        TierSynchronization: 'False'
        InterTierOrchestrationDelay: 1
      TierScaling:
        DevMode: 
          InstanceType: t2.nano
          FleetSubset: '1'
        HATestMode:
          InstanceType: t3.micro
          FleetSubset: '2'
        PerfTestMode:
          InstanceType: t3.medium
          FleetSubset: 100%
        ProdMode:
          InstanceType: t3.large
          FleetSubset: 100%

    - TierTagValue: Role_App
      SpecName: SampleWorkload-02
      TierStart:
        TierSequence: 1
        TierSynchronization: 'False'
        InterTierOrchestrationDelay: 1
      TierStop:
        TierSequence: 1
        TierSynchronization: 'False'
        InterTierOrchestrationDelay: 1
      TierScaling:
        DevMode: 
          InstanceType: t2.nano
          FleetSubset: '1'
        HATestMode:
          InstanceType: t2.micro
          FleetSubset: '2'
        PerfTestMode:
          InstanceType: t3.large
          FleetSubset: 100%
        ProdMode:
          InstanceType: m5.large
          FleetSubset: 100%

    - TierTagValue: Role_DB
      SpecName: SampleWorkload-02
      TierStart:
        TierSequence: 0
        TierSynchronization: 'False'
        InterTierOrchestrationDelay: 2
      TierStop:
        TierSequence: 2
        TierSynchronization: 'False'
        InterTierOrchestrationDelay: 2
      TierScaling:
        DevMode: 
          InstanceType: t2.nano
        HATestMode:
          InstanceType: t2.micro
        PerfTestMode:
          InstanceType: t3.large
        ProdMode:
          InstanceType: m5.large
